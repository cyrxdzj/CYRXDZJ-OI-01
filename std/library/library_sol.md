## 内心深处的图书馆 题解

### 本题难点与坑点

以下是本题主要考查以下难点与坑点。

该列表仅用于显示出题人安排部分分的思路，不影响评测结果。

#### 快速计算区间

内容：本题 $n$ 值较大，不允许一个个计算。

如何向选手出示难点：明确写明数据范围。

正解对策：分块。

部分分对策：莫队。

若仅完成部分分对策，至少扣除 $52$ 分。

若上述对策均未完成，可能导致程序运行超时，至少扣除 $80$ 分。

#### 快速维护贡献

内容：通过 $\log$ 级别的数据结构，快速查询每种**头脑清醒度**下的概率。

如何向选手出示难点：明确写明数据范围。

正解对策：树状数组或线段树。

若未完成正解对策，可能导致程序运行超时，至少扣除 $72$ 分。

#### 较大的值域

内容：头脑清醒度和难度值值域较大。

如何向选手出示难点：明确写明数据范围。

正解对策：树状数组：离散化；线段树：离散化或动态开点线段树。

若未完成正解对策，可能导致程序空间超限，至少扣除 $56$ 分。

#### 概率为 0

内容：在部分头脑清醒度下，不可能读懂全部翻开的书页。但 $0$ 没有逆元，无法正常退回贡献。

如何向选手出示难点：提供大样例。

正解对策：封装特制数结构体，记录乘 $0$ 的次数。

若未完成正解对策，可能导致程序持续输出 $0$，至少扣除 $52$ 分或 $40$ 分（第5,7,9号测试点不使用莫队可规避）。

具有此性质的测试点：5,7,9,15~17,19~25，样例2,样例4,样例5。

#### 相同难度的书页

内容：使用线段树维护贡献时，部分书页难度相同，若未考虑到，进行区间修改时会导致左端点大于右端点。

如何向选手出示难点：提供大样例。

正解对策：合并这两页。

若未完成正解对策，可能导致程序运行时错误，至少扣除 $40$ 分。

具有此性质的测试点：9,16~17,19~25，样例3,样例4,样例5。

### 版权信息

题解：[邓子君](https://www.luogu.com.cn/user/387836)

本题改编自广州市赛 2024 D2T4，是原题的加强版。

在 [CC-BY-NC 4.0](https://creativecommons.org/licenses/by-nc/4.0/legalcode.zh-hans) 协议下共享。
